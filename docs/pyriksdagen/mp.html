<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.2" />
<title>pyriksdagen.mp API documentation</title>
<meta name="description" content="Handles the data on the members of parliament." />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML" integrity="sha256-kZafAc6mZvK3W3v1pHOcUix30OHQN6pU/NO2oFkqZVw=" crossorigin></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>pyriksdagen.mp</code></h1>
</header>
<section id="section-intro">
<p>Handles the data on the members of parliament.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;
Handles the data on the members of parliament.
&#34;&#34;&#34;

import pandas as pd
import os, re
import progressbar
import hashlib
import unicodedata

def create_database(path):
    extension = path.split(&#34;.&#34;)[-1]

    if extension == &#34;csv&#34;:
        print(&#34;Read:&#34;, path)
        df = pd.read_csv(path, skip_blank_lines=True)

        # Drop columns where everything is null
        nulls = df.isnull().values.all(axis=0)
        nulls = zip(df.columns, nulls)
        for column_name, null in nulls:
            if null:
                del df[column_name]
        
        new_columns = list(df.columns)
        for column_ix, column_name in enumerate(df.columns):
            if &#34;.&#34; in column_name:
                new_name = column_name.split(&#34;.&#34;)[0]
                new_columns[column_ix] = new_name
        
        df.columns = new_columns
        
    elif extension == &#34;txt&#34;:
        print(&#34;Read:&#34;, path)
        f = open(path)
        columns = [&#34;Riksdagsledamot&#34;, &#34;Parti&#34;, &#34;Valkrets&#34;]
        
        rows = []
        lan = None
        for line in f:
            line = line.replace(&#34;\n&#34;, &#34;&#34;)
            if len(line) &gt; 2:
                indented = line[:4] == &#34;    &#34;
                
                # Non-indented lines are titles, which correspond to &#39;län&#39; / region
                if not indented:
                    lan = line
                else:
                    row = line.split(&#34;,&#34;)
                    row = [x.strip() for x in row]
                    
                    datapoint = []
                    # Add name
                    name = row[0]
                    datapoint.append(name)
                    # Add party
                    possible_parties = [s for s in row if &#34;f.&#34; not in s]
                    party = possible_parties[-1]
                    party = re.sub(r&#39;\(.*?\)&#39;, &#39;&#39;, party)
                    party = re.sub(r&#39;\[.*?\]&#39;, &#39;&#39;, party).strip()
                    if len(party) &lt; 4 or party.lower() != party:
                        datapoint.append(party)
                    else:
                        datapoint.append(None)
                    # Add &#39;län&#39; / region
                    datapoint.append(lan)
                    rows.append(datapoint)

        df = pd.DataFrame(rows, columns = columns)
    else:
        print(&#34;File type not supported.&#34;, path)
        return None
    
    # Harmonize column names
    new_columns = list(df.columns)
    for column_ix, column_name in enumerate(df.columns):
        if column_name in [&#34;Ledamot&#34;, &#34;Riksdagsledamot&#34;, &#34;Namn&#34;]:
            new_columns[column_ix] = &#34;name&#34;
        if column_name in [&#34;Parti&#34;]:
            new_columns[column_ix] = &#34;party&#34;
        if column_name in [&#34;Yrke&#34;]:
            new_columns[column_ix] = &#34;occupation&#34;
        if column_name in [&#34;Valkrets&#34;]:
            new_columns[column_ix] = &#34;district&#34;

    df.columns = new_columns
    
    # Drop unnecessary columns
    retain = [&#34;name&#34;, &#34;party&#34;, &#34;district&#34;, &#34;occupation&#34;]
    for column_name in df.columns:
        if column_name not in retain:
            del df[column_name]
    
    # Chamber
    chamber = &#34;Enkammarriksdagen&#34;
    potential_chamber = path.split(&#34;/&#34;)[-2]
    if potential_chamber == &#34;ak&#34;:
        chamber = &#34;Andra kammaren&#34;
    elif potential_chamber == &#34;fk&#34;:
        chamber = &#34;Första kammaren&#34;
    df[&#34;chamber&#34;] = chamber
    
    # Year in office
    year_str = path.split(&#34;/&#34;)[-1].split(&#34;.&#34;)[0].replace(&#34;–­­&#34;, &#34;-&#34;)
    if len(year_str) == 9:
        df[&#34;start&#34;] = int(year_str[:4])
        df[&#34;end&#34;] = int(year_str[-4:])
    elif len(year_str) == 4:
        # TODO: Currently using +-3 year heuristic because exact terms
        # are unavailable.
        if chamber == &#34;Första kammaren&#34;:
            df[&#34;start&#34;] = int(year_str) - 3
            df[&#34;end&#34;] = int(year_str) + 3
        else:
            df[&#34;start&#34;] = int(year_str)
            df[&#34;end&#34;] = int(year_str)
    else:
        print(year_str)
    
    return df

def create_full_database(dirs):
    mp_dbs = []
    for d in dirs:
        for path in os.listdir(d):
            full_path = os.path.join(d, path)
            mp_db = create_database(full_path)
            if mp_db is not None:
                mp_dbs.append(mp_db)
    mp_db = pd.concat(mp_dbs)
    
    mp_db = mp_db.sort_values(by=[&#34;start&#34;, &#34;chamber&#34;, &#34;name&#34;], ignore_index=True)

    columnsTitles = [&#39;name&#39; , &#39;party&#39;, &#39;district&#39;, &#39;chamber&#39;, &#39;start&#39;, &#39;end&#39;, &#39;occupation&#39;]
    mp_db = mp_db.reindex(columns=columnsTitles)

    mp_db = mp_db[mp_db[&#34;name&#34;].notnull()]

    print(mp_db[mp_db[&#34;start&#34;].isnull()])
    mp_db.start = mp_db.start.astype(int)
    mp_db.end = mp_db.end.astype(int)
    return mp_db

def add_gender(mp_db, names):
    print(&#34;Add gender...&#34;)
    mp_db[&#34;gender&#34;] = None

    name_to_gender = {}
    for i, namerow in names.iterrows():
        name = namerow[&#34;name&#34;]
        gender = namerow[&#34;gender&#34;]
        if gender == &#34;masculine&#34;:
            gender = &#34;man&#34;
        elif gender == &#34;feminine&#34;:
            gender = &#34;woman&#34;
        name_to_gender[name] = gender

    for i, row in progressbar.progressbar(list(mp_db.iterrows())):
        first_name = row[&#34;name&#34;].split()[0]
        if &#34;-&#34; in first_name:
            first_name = first_name.split(&#34;-&#34;)[0]
        if first_name in name_to_gender:
            mp_db.loc[i, &#39;gender&#39;] = name_to_gender[first_name]

    return mp_db

def clean_names(mp_db):
    print(&#34;Clean names...&#34;)
    for i, row in progressbar.progressbar(list(mp_db.iterrows())):
        name = row[&#34;name&#34;]
        split_i = name.split(&#34; i &#34;)
        if name != split_i[0]:
            name = split_i[0]
            if len(split_i) &gt; 1:
                mp_db.loc[i, &#39;specifier&#39;] = &#34;i &#34; + split_i[1]
            else:
                mp_db.loc[i, &#39;specifier&#39;] = None
        if &#34;[&#34; in name:
            name = name.split(&#34;[&#34;)[0]
        if &#34;(er&#34; in name:
            name = name.split(&#34;(er&#34;)[0]
        if &#34;ersatt av&#34; in name:
            name = name.split(&#34;ersatt av:&#34;)[-1]
        name = name.strip()
        assert name != &#34;&#34;, &#34;names can&#39;t be empty: &#34; + row[&#34;name&#34;]
        mp_db.loc[i, &#39;name&#39;] = name

    return mp_db

def replace_party_abbreviations(mp_db, party_db):
    print(&#34;Replace party abbreviations...&#34;)
    party_dict = dict()
    for _, row in party_db.iterrows():
        party = row[&#34;party&#34;]
        abbreviation = row[&#34;abbreviation&#34;]
        party_dict[abbreviation] = party
    
    
    for i, row in progressbar.progressbar(list(mp_db.iterrows())):
        current_party = row[&#34;party&#34;]
        if type(current_party) == str:
            # Check if &#39;party&#39; attribute is in the list of abbreviations
            row_party = current_party.strip().lower()
            if row_party in party_dict:
                mp_db.loc[i, &#39;party&#39;] = party_dict[row_party]
    
    return mp_db

def add_id(mp_db):
    print(&#34;Add id...&#34;)
    columns = mp_db.columns
    columns = [&#34;name&#34;, &#34;party&#34;, &#34;district&#34;, &#34;chamber&#34;, &#34;start&#34;, &#34;end&#34;]
    mp_db[&#34;id&#34;] = None
    print(&#34;columns used for generation:&#34;, &#34;, &#34;.join(columns))
    for i, row in progressbar.progressbar(list(mp_db.iterrows())):
        name = unicodedata.normalize(&#34;NFD&#34;, row[&#34;name&#34;])
        name = name.encode(&#34;ascii&#34;, &#34;ignore&#34;).decode(&#34;utf-8&#34;)
        name = name.lower().replace(&#34; &#34;, &#34;_&#34;)
        name = name.replace(&#34;.&#34;, &#34;&#34;).replace(&#34;(&#34;, &#34;&#34;).replace(&#34;)&#34;, &#34;&#34;).replace(&#34;:&#34;, &#34;&#34;)
        party = row.get(&#34;party&#34;)

        pattern = [name]
        for column in columns:
            value = row[column]
            if type(value) != str:
                value = str(value)
            pattern.append(value)

        pattern = &#34;_&#34;.join(pattern).replace(&#34; &#34;, &#34;_&#34;).lower()

        digest = hashlib.md5(pattern.encode(&#34;utf-8&#34;)).hexdigest()
        mp_db.loc[i, &#39;id&#39;] = name + &#34;_&#34; + digest[:6]

    return mp_db

def add_municipality(mp_db, mun_db):

    original_columns = list(mp_db.columns)
    print(&#34;Add municipalicites from &#39;personregister&#39;...&#34;)
    def reorder_name(name):
        s = name.split(&#34;,&#34;)
        if len(s) == 1:
            return name
        else:
            newname = s[1].strip() + &#34; &#34; + s[0].strip()
            return newname
    mun_db[&#34;name&#34;] = mun_db[&#34;name&#34;].apply(lambda n: reorder_name(n))
    mun_db = mun_db[mun_db[&#34;municipality&#34;].notnull()]
    mun_db[&#34;municipality&#34;].apply(lambda x: &#34;i &#34; + x.strip())
    mun_db[&#34;decade&#34;] = mun_db[&#34;decade&#34;].apply(lambda decade: (decade // 10 ) * 10)

    outdfs = []
    #mp_db[&#34;municipality&#34;] = None

    start_min = min(set(mp_db[&#34;start&#34;]))
    end_max = max(set(mp_db[&#34;end&#34;]))

    start_min = (start_min // 10) * 10
    end_max = (end_max // 10 + 1) * 10
    for decade in range(start_min, end_max, 10):
        current_mun_db = mun_db[mun_db[&#34;decade&#34;] == decade]
        current_mpdb = mp_db[(mp_db[&#34;end&#34;] &gt;= decade) &amp; (mp_db[&#34;start&#34;] &lt; decade + 10)]
        if not current_mun_db.empty:
            current_mun_db = current_mun_db[[&#34;name&#34;, &#34;municipality&#34;]]

            mpdb_names = list(current_mpdb[&#34;name&#34;])

            def rname(name):
                nameset = set(name.split())

                namesplit = name.split()
                for mpdb_name in mpdb_names:
                    mpdbsplit = mpdb_name.split()
                    samefirst = namesplit[0] == mpdbsplit[0]
                    samelast = namesplit[-1] == mpdbsplit[-1]
                    if samefirst and samelast and abs(len(namesplit) - len(mpdbsplit)) &lt;= 1:
                        return mpdb_name.strip()
                return name.strip()


            replacedname = rname(&#34;Carl Wilhelm Höglund&#34;)

            print(&#34;Carl Wilhelm Höglund&#34;, &#34;=&gt;&#34;, replacedname, decade)
            current_mun_db[&#34;name&#34;] = current_mun_db[&#34;name&#34;].apply(lambda n: rname(n))
            merged = pd.merge(current_mpdb, current_mun_db, how=&#34;left&#34;, on=&#34;name&#34;)
            merged.to_csv(&#34;merged_&#34;+ str(decade) + &#34;.csv&#34;, index = False)

            newnames = set(current_mun_db[&#34;name&#34;])
            outdfs.append(merged)
            print(&#34;Carl Wilhelm Oskar Höglund in newnames&#34;, &#34;Carl Wilhelm Oskar Höglund&#34; in newnames)
        else:
            outdfs.append(current_mpdb)


    mp_db = pd.concat(outdfs)
    print(mp_db)
    mp_db[&#34;municipality&#34;] = &#34;i &#34; + mp_db[&#34;municipality&#34;].str.strip()
    mp_db[&#34;specifier&#34;] = mp_db[&#34;specifier&#34;].fillna(mp_db[&#34;municipality&#34;])
    mp_db = mp_db.drop(&#34;municipality&#34;, axis=1)

    mp_db = mp_db.groupby(&#34;id&#34;).first().reset_index()
    mp_db = mp_db[original_columns]
    mp_db = mp_db.sort_values(by=[&#34;start&#34;, &#34;chamber&#34;, &#34;name&#34;], ignore_index=True)
    return mp_db

def detect_mp(introduction, metadata, mp_db):
    &#34;&#34;&#34;
    Detect which member of parliament is mentioned in a given introduction.

    Params:
        introuction: An introduction to a speech in the protocols. String.
        metadata: Year and chamber of the parliamentary proceeding in question. Dict.
        mp_db: MP database as a Pandas DataFrame.
    &#34;&#34;&#34;

    year = metadata[&#34;year&#34;]
    mp_db = mp_db[(mp_db[&#34;start&#34;] &lt;= year) &amp; (mp_db[&#34;end&#34;] &gt;= year)]

    for ix, row in mp_db.iterrows():
        name = row[&#34;name&#34;]
        last_name = &#34; &#34;.join(name.split()[1:])
        if last_name in introduction:
            return row</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="pyriksdagen.mp.add_gender"><code class="name flex">
<span>def <span class="ident">add_gender</span></span>(<span>mp_db, names)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add_gender(mp_db, names):
    print(&#34;Add gender...&#34;)
    mp_db[&#34;gender&#34;] = None

    name_to_gender = {}
    for i, namerow in names.iterrows():
        name = namerow[&#34;name&#34;]
        gender = namerow[&#34;gender&#34;]
        if gender == &#34;masculine&#34;:
            gender = &#34;man&#34;
        elif gender == &#34;feminine&#34;:
            gender = &#34;woman&#34;
        name_to_gender[name] = gender

    for i, row in progressbar.progressbar(list(mp_db.iterrows())):
        first_name = row[&#34;name&#34;].split()[0]
        if &#34;-&#34; in first_name:
            first_name = first_name.split(&#34;-&#34;)[0]
        if first_name in name_to_gender:
            mp_db.loc[i, &#39;gender&#39;] = name_to_gender[first_name]

    return mp_db</code></pre>
</details>
</dd>
<dt id="pyriksdagen.mp.add_id"><code class="name flex">
<span>def <span class="ident">add_id</span></span>(<span>mp_db)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add_id(mp_db):
    print(&#34;Add id...&#34;)
    columns = mp_db.columns
    columns = [&#34;name&#34;, &#34;party&#34;, &#34;district&#34;, &#34;chamber&#34;, &#34;start&#34;, &#34;end&#34;]
    mp_db[&#34;id&#34;] = None
    print(&#34;columns used for generation:&#34;, &#34;, &#34;.join(columns))
    for i, row in progressbar.progressbar(list(mp_db.iterrows())):
        name = unicodedata.normalize(&#34;NFD&#34;, row[&#34;name&#34;])
        name = name.encode(&#34;ascii&#34;, &#34;ignore&#34;).decode(&#34;utf-8&#34;)
        name = name.lower().replace(&#34; &#34;, &#34;_&#34;)
        name = name.replace(&#34;.&#34;, &#34;&#34;).replace(&#34;(&#34;, &#34;&#34;).replace(&#34;)&#34;, &#34;&#34;).replace(&#34;:&#34;, &#34;&#34;)
        party = row.get(&#34;party&#34;)

        pattern = [name]
        for column in columns:
            value = row[column]
            if type(value) != str:
                value = str(value)
            pattern.append(value)

        pattern = &#34;_&#34;.join(pattern).replace(&#34; &#34;, &#34;_&#34;).lower()

        digest = hashlib.md5(pattern.encode(&#34;utf-8&#34;)).hexdigest()
        mp_db.loc[i, &#39;id&#39;] = name + &#34;_&#34; + digest[:6]

    return mp_db</code></pre>
</details>
</dd>
<dt id="pyriksdagen.mp.add_municipality"><code class="name flex">
<span>def <span class="ident">add_municipality</span></span>(<span>mp_db, mun_db)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add_municipality(mp_db, mun_db):

    original_columns = list(mp_db.columns)
    print(&#34;Add municipalicites from &#39;personregister&#39;...&#34;)
    def reorder_name(name):
        s = name.split(&#34;,&#34;)
        if len(s) == 1:
            return name
        else:
            newname = s[1].strip() + &#34; &#34; + s[0].strip()
            return newname
    mun_db[&#34;name&#34;] = mun_db[&#34;name&#34;].apply(lambda n: reorder_name(n))
    mun_db = mun_db[mun_db[&#34;municipality&#34;].notnull()]
    mun_db[&#34;municipality&#34;].apply(lambda x: &#34;i &#34; + x.strip())
    mun_db[&#34;decade&#34;] = mun_db[&#34;decade&#34;].apply(lambda decade: (decade // 10 ) * 10)

    outdfs = []
    #mp_db[&#34;municipality&#34;] = None

    start_min = min(set(mp_db[&#34;start&#34;]))
    end_max = max(set(mp_db[&#34;end&#34;]))

    start_min = (start_min // 10) * 10
    end_max = (end_max // 10 + 1) * 10
    for decade in range(start_min, end_max, 10):
        current_mun_db = mun_db[mun_db[&#34;decade&#34;] == decade]
        current_mpdb = mp_db[(mp_db[&#34;end&#34;] &gt;= decade) &amp; (mp_db[&#34;start&#34;] &lt; decade + 10)]
        if not current_mun_db.empty:
            current_mun_db = current_mun_db[[&#34;name&#34;, &#34;municipality&#34;]]

            mpdb_names = list(current_mpdb[&#34;name&#34;])

            def rname(name):
                nameset = set(name.split())

                namesplit = name.split()
                for mpdb_name in mpdb_names:
                    mpdbsplit = mpdb_name.split()
                    samefirst = namesplit[0] == mpdbsplit[0]
                    samelast = namesplit[-1] == mpdbsplit[-1]
                    if samefirst and samelast and abs(len(namesplit) - len(mpdbsplit)) &lt;= 1:
                        return mpdb_name.strip()
                return name.strip()


            replacedname = rname(&#34;Carl Wilhelm Höglund&#34;)

            print(&#34;Carl Wilhelm Höglund&#34;, &#34;=&gt;&#34;, replacedname, decade)
            current_mun_db[&#34;name&#34;] = current_mun_db[&#34;name&#34;].apply(lambda n: rname(n))
            merged = pd.merge(current_mpdb, current_mun_db, how=&#34;left&#34;, on=&#34;name&#34;)
            merged.to_csv(&#34;merged_&#34;+ str(decade) + &#34;.csv&#34;, index = False)

            newnames = set(current_mun_db[&#34;name&#34;])
            outdfs.append(merged)
            print(&#34;Carl Wilhelm Oskar Höglund in newnames&#34;, &#34;Carl Wilhelm Oskar Höglund&#34; in newnames)
        else:
            outdfs.append(current_mpdb)


    mp_db = pd.concat(outdfs)
    print(mp_db)
    mp_db[&#34;municipality&#34;] = &#34;i &#34; + mp_db[&#34;municipality&#34;].str.strip()
    mp_db[&#34;specifier&#34;] = mp_db[&#34;specifier&#34;].fillna(mp_db[&#34;municipality&#34;])
    mp_db = mp_db.drop(&#34;municipality&#34;, axis=1)

    mp_db = mp_db.groupby(&#34;id&#34;).first().reset_index()
    mp_db = mp_db[original_columns]
    mp_db = mp_db.sort_values(by=[&#34;start&#34;, &#34;chamber&#34;, &#34;name&#34;], ignore_index=True)
    return mp_db</code></pre>
</details>
</dd>
<dt id="pyriksdagen.mp.clean_names"><code class="name flex">
<span>def <span class="ident">clean_names</span></span>(<span>mp_db)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def clean_names(mp_db):
    print(&#34;Clean names...&#34;)
    for i, row in progressbar.progressbar(list(mp_db.iterrows())):
        name = row[&#34;name&#34;]
        split_i = name.split(&#34; i &#34;)
        if name != split_i[0]:
            name = split_i[0]
            if len(split_i) &gt; 1:
                mp_db.loc[i, &#39;specifier&#39;] = &#34;i &#34; + split_i[1]
            else:
                mp_db.loc[i, &#39;specifier&#39;] = None
        if &#34;[&#34; in name:
            name = name.split(&#34;[&#34;)[0]
        if &#34;(er&#34; in name:
            name = name.split(&#34;(er&#34;)[0]
        if &#34;ersatt av&#34; in name:
            name = name.split(&#34;ersatt av:&#34;)[-1]
        name = name.strip()
        assert name != &#34;&#34;, &#34;names can&#39;t be empty: &#34; + row[&#34;name&#34;]
        mp_db.loc[i, &#39;name&#39;] = name

    return mp_db</code></pre>
</details>
</dd>
<dt id="pyriksdagen.mp.create_database"><code class="name flex">
<span>def <span class="ident">create_database</span></span>(<span>path)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def create_database(path):
    extension = path.split(&#34;.&#34;)[-1]

    if extension == &#34;csv&#34;:
        print(&#34;Read:&#34;, path)
        df = pd.read_csv(path, skip_blank_lines=True)

        # Drop columns where everything is null
        nulls = df.isnull().values.all(axis=0)
        nulls = zip(df.columns, nulls)
        for column_name, null in nulls:
            if null:
                del df[column_name]
        
        new_columns = list(df.columns)
        for column_ix, column_name in enumerate(df.columns):
            if &#34;.&#34; in column_name:
                new_name = column_name.split(&#34;.&#34;)[0]
                new_columns[column_ix] = new_name
        
        df.columns = new_columns
        
    elif extension == &#34;txt&#34;:
        print(&#34;Read:&#34;, path)
        f = open(path)
        columns = [&#34;Riksdagsledamot&#34;, &#34;Parti&#34;, &#34;Valkrets&#34;]
        
        rows = []
        lan = None
        for line in f:
            line = line.replace(&#34;\n&#34;, &#34;&#34;)
            if len(line) &gt; 2:
                indented = line[:4] == &#34;    &#34;
                
                # Non-indented lines are titles, which correspond to &#39;län&#39; / region
                if not indented:
                    lan = line
                else:
                    row = line.split(&#34;,&#34;)
                    row = [x.strip() for x in row]
                    
                    datapoint = []
                    # Add name
                    name = row[0]
                    datapoint.append(name)
                    # Add party
                    possible_parties = [s for s in row if &#34;f.&#34; not in s]
                    party = possible_parties[-1]
                    party = re.sub(r&#39;\(.*?\)&#39;, &#39;&#39;, party)
                    party = re.sub(r&#39;\[.*?\]&#39;, &#39;&#39;, party).strip()
                    if len(party) &lt; 4 or party.lower() != party:
                        datapoint.append(party)
                    else:
                        datapoint.append(None)
                    # Add &#39;län&#39; / region
                    datapoint.append(lan)
                    rows.append(datapoint)

        df = pd.DataFrame(rows, columns = columns)
    else:
        print(&#34;File type not supported.&#34;, path)
        return None
    
    # Harmonize column names
    new_columns = list(df.columns)
    for column_ix, column_name in enumerate(df.columns):
        if column_name in [&#34;Ledamot&#34;, &#34;Riksdagsledamot&#34;, &#34;Namn&#34;]:
            new_columns[column_ix] = &#34;name&#34;
        if column_name in [&#34;Parti&#34;]:
            new_columns[column_ix] = &#34;party&#34;
        if column_name in [&#34;Yrke&#34;]:
            new_columns[column_ix] = &#34;occupation&#34;
        if column_name in [&#34;Valkrets&#34;]:
            new_columns[column_ix] = &#34;district&#34;

    df.columns = new_columns
    
    # Drop unnecessary columns
    retain = [&#34;name&#34;, &#34;party&#34;, &#34;district&#34;, &#34;occupation&#34;]
    for column_name in df.columns:
        if column_name not in retain:
            del df[column_name]
    
    # Chamber
    chamber = &#34;Enkammarriksdagen&#34;
    potential_chamber = path.split(&#34;/&#34;)[-2]
    if potential_chamber == &#34;ak&#34;:
        chamber = &#34;Andra kammaren&#34;
    elif potential_chamber == &#34;fk&#34;:
        chamber = &#34;Första kammaren&#34;
    df[&#34;chamber&#34;] = chamber
    
    # Year in office
    year_str = path.split(&#34;/&#34;)[-1].split(&#34;.&#34;)[0].replace(&#34;–­­&#34;, &#34;-&#34;)
    if len(year_str) == 9:
        df[&#34;start&#34;] = int(year_str[:4])
        df[&#34;end&#34;] = int(year_str[-4:])
    elif len(year_str) == 4:
        # TODO: Currently using +-3 year heuristic because exact terms
        # are unavailable.
        if chamber == &#34;Första kammaren&#34;:
            df[&#34;start&#34;] = int(year_str) - 3
            df[&#34;end&#34;] = int(year_str) + 3
        else:
            df[&#34;start&#34;] = int(year_str)
            df[&#34;end&#34;] = int(year_str)
    else:
        print(year_str)
    
    return df</code></pre>
</details>
</dd>
<dt id="pyriksdagen.mp.create_full_database"><code class="name flex">
<span>def <span class="ident">create_full_database</span></span>(<span>dirs)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def create_full_database(dirs):
    mp_dbs = []
    for d in dirs:
        for path in os.listdir(d):
            full_path = os.path.join(d, path)
            mp_db = create_database(full_path)
            if mp_db is not None:
                mp_dbs.append(mp_db)
    mp_db = pd.concat(mp_dbs)
    
    mp_db = mp_db.sort_values(by=[&#34;start&#34;, &#34;chamber&#34;, &#34;name&#34;], ignore_index=True)

    columnsTitles = [&#39;name&#39; , &#39;party&#39;, &#39;district&#39;, &#39;chamber&#39;, &#39;start&#39;, &#39;end&#39;, &#39;occupation&#39;]
    mp_db = mp_db.reindex(columns=columnsTitles)

    mp_db = mp_db[mp_db[&#34;name&#34;].notnull()]

    print(mp_db[mp_db[&#34;start&#34;].isnull()])
    mp_db.start = mp_db.start.astype(int)
    mp_db.end = mp_db.end.astype(int)
    return mp_db</code></pre>
</details>
</dd>
<dt id="pyriksdagen.mp.detect_mp"><code class="name flex">
<span>def <span class="ident">detect_mp</span></span>(<span>introduction, metadata, mp_db)</span>
</code></dt>
<dd>
<div class="desc"><p>Detect which member of parliament is mentioned in a given introduction.</p>
<h2 id="params">Params</h2>
<p>introuction: An introduction to a speech in the protocols. String.
metadata: Year and chamber of the parliamentary proceeding in question. Dict.
mp_db: MP database as a Pandas DataFrame.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def detect_mp(introduction, metadata, mp_db):
    &#34;&#34;&#34;
    Detect which member of parliament is mentioned in a given introduction.

    Params:
        introuction: An introduction to a speech in the protocols. String.
        metadata: Year and chamber of the parliamentary proceeding in question. Dict.
        mp_db: MP database as a Pandas DataFrame.
    &#34;&#34;&#34;

    year = metadata[&#34;year&#34;]
    mp_db = mp_db[(mp_db[&#34;start&#34;] &lt;= year) &amp; (mp_db[&#34;end&#34;] &gt;= year)]

    for ix, row in mp_db.iterrows():
        name = row[&#34;name&#34;]
        last_name = &#34; &#34;.join(name.split()[1:])
        if last_name in introduction:
            return row</code></pre>
</details>
</dd>
<dt id="pyriksdagen.mp.replace_party_abbreviations"><code class="name flex">
<span>def <span class="ident">replace_party_abbreviations</span></span>(<span>mp_db, party_db)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def replace_party_abbreviations(mp_db, party_db):
    print(&#34;Replace party abbreviations...&#34;)
    party_dict = dict()
    for _, row in party_db.iterrows():
        party = row[&#34;party&#34;]
        abbreviation = row[&#34;abbreviation&#34;]
        party_dict[abbreviation] = party
    
    
    for i, row in progressbar.progressbar(list(mp_db.iterrows())):
        current_party = row[&#34;party&#34;]
        if type(current_party) == str:
            # Check if &#39;party&#39; attribute is in the list of abbreviations
            row_party = current_party.strip().lower()
            if row_party in party_dict:
                mp_db.loc[i, &#39;party&#39;] = party_dict[row_party]
    
    return mp_db</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="pyriksdagen" href="index.html">pyriksdagen</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="pyriksdagen.mp.add_gender" href="#pyriksdagen.mp.add_gender">add_gender</a></code></li>
<li><code><a title="pyriksdagen.mp.add_id" href="#pyriksdagen.mp.add_id">add_id</a></code></li>
<li><code><a title="pyriksdagen.mp.add_municipality" href="#pyriksdagen.mp.add_municipality">add_municipality</a></code></li>
<li><code><a title="pyriksdagen.mp.clean_names" href="#pyriksdagen.mp.clean_names">clean_names</a></code></li>
<li><code><a title="pyriksdagen.mp.create_database" href="#pyriksdagen.mp.create_database">create_database</a></code></li>
<li><code><a title="pyriksdagen.mp.create_full_database" href="#pyriksdagen.mp.create_full_database">create_full_database</a></code></li>
<li><code><a title="pyriksdagen.mp.detect_mp" href="#pyriksdagen.mp.detect_mp">detect_mp</a></code></li>
<li><code><a title="pyriksdagen.mp.replace_party_abbreviations" href="#pyriksdagen.mp.replace_party_abbreviations">replace_party_abbreviations</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.2</a>.</p>
</footer>
</body>
</html>